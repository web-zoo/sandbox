<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>METAR</title>

</head>

<body>
  <h1>METAR</h1>

  <section id="output"></section>

 	<iframe name="stations" style="display:none"><p>Your browser does not support iframes.</p></iframe>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>  <script>

  
  let stations;

  // aviationweather does not work with cors, shoud allow jsonp with ?jsonp=myFunc
  stations = 'https://aviationweather.gov/gis/scripts/MetarSiteJSON.php';
  //stations = 'https://aviationweather.gov/windtemp/data?level=l&fcst=06&region=all&layout=off'

  // synopticlabs works with cors
 	//stations = 'https://api.synopticlabs.org/v2/stations/metadata?&token=baca761a1c6c4e75820d4565ffb9490d&output=json';


 	document.querySelector('iframe').src = stations;

  fetch(stations, {
		method: 'GET',
		mode: 'cors'
	})
  .then(
    function(response) {
      if (response.status !== 200) {
        console.log('Looks like there was a problem. Status Code: ' +
          response.status);
        return;
      }
      console.log(response);

   
      // Examine the text in the response
      // response.json().then(function(data) {
      //   console.log(data);
      // });
      response.text().then(function(data) {
        //console.log(data);
      });
    }
  )
  .catch(function(err) {
    console.log('Fetch Error :-S', err);
  });

  



  //const stations = 'http://weather.rap.ucar.edu/surface/stations.txt';
  //const stations = 'https://www.aviationweather.gov/docs/metar/stations.txt';


	function foo(response) {
	  //document.getElementById("output").innerHTML = response.bar;
	  console.log('foo', response);
	};

	var tag = document.createElement("script");
	//tag.src = "https://www.aviationweather.gov/gis/scripts/MetarJSON.php?"+"jsonp=foo";
	tag.src = "https://aviationweather.gov/windtemp/data?level=l&fcst=06&region=all&layout=off"
	tag.type = 'application/javascript';
	// note application/javascript was a problem!
	document.getElementsByTagName("head")[0].appendChild(tag);

</script>


<script>
	var parseJSON =  function(json) {
    console.log('returned:', json);
}
</script>
<script type="application/javascript" src="https://www.aviationweather.gov/gis/scripts/MetarJSON.php?taf=true&bbox=-86,41,-82,45&jsonp=parseJSON"></script>




  <footer>SM &copy; 2017</footer>
</body>

</html>
